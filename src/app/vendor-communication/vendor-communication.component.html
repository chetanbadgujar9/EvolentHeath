<div class="page-content">
    <ol class="breadcrumb">
        <li>
            <h5 style="color:black;font-size: 15px;font-weight: 700;">Vendor Communication</h5>
        </li>
        <li class="pull-right" *ngIf="userRole === 'designer'">
            <a routerLink="create-vendor-communication" class="btn btn-midnightblue btn-sm">Create Request</a>
        </li>
        <li class="pull-right" *ngIf="userRole === 'vendor'">
            <a (click)="onNotice()" class="btn btn-warning btn-sm">Refresh <i class="fa fa-refresh" aria-hidden="true"></i></a>
        </li>
    </ol>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12 col-sm-12 col-lg-12">
                <div class="col-lg-5 col-md-5" *ngIf="userRole !== 'vendor'">
                    <div class="btn-group btn-group-justified">
                        <a class="btn btn-primary" role="button" [style.background-color]="requestColor" [style.border-color]="requestColor" (click)="onRequest()">Request ({{requestCounter ? requestCounter : 0}})</a>
                        <a class="btn btn-primary" role="button" [style.background-color]="noticeColor" [style.border-color]="noticeColor" (click)="onNotice()">Notice ({{noticeCounter ? noticeCounter : 0}})</a>
                    </div>
                </div>
                <div class="ui-widget-header gridHeader">
                    <div class="searchHeader">
                        <i class="fa fa-search" style="margin:4px 4px 0 0"></i>
                        <input #gb type="text" pInputText size="25" placeholder="Search">
                    </div>
                </div>
                <!-- expandableRows="true" rowExpandMode="multiple" (onRowClick)="dt.toggleRow($event.data)" -->
                <p-dataTable #dt [value]="_tempData" [globalFilter]="gb" [responsive]="true" [paginator]="true" [pageLinks]="3" [rowsPerPageOptions]="[200,500,750,1000]"
                    [rows]="200" reorderableColumns="true" [rowHover]="true" sortField="Status" rowGroupMode="subheader" groupField="Status"
                    expandableRowGroups="true" expandableRows="true" rowExpandMode="multiple" (onRowClick)="dt.toggleRow($event.data)">
                    <ng-template pTemplate="rowgroupheader" let-rowData>
                        <b>{{rowData['Status'] ? (rowData['Status'].split('-')[1] ? rowData['Status'].split('-')[1] : rowData['Status'].split('-')[0]
                            ) : ''}} ({{rowCouter(rowData['Status'])}})
                        </b>
                    </ng-template>
                    <p-column field="Title" header="VCID" [style]="{'overflow':'visible','text-align':'left','vertical-align': 'top'}">
                        <ng-template let-col let-rowData="rowData" pTemplate="body">
                            <a (click)="onViewRequest(rowData)" pTooltip="Click to View Request" tooltipPosition="left">
                                <u>{{rowData[col.field]}}</u>
                            </a>
                        </ng-template>
                    </p-column>
                    <p-column field="Category" header="Category" [style]="{'overflow':'visible','text-align':'left','vertical-align': 'top'}"></p-column>
                    <p-column field="Brand" header="Brand" [style]="{'overflow':'visible','text-align':'left','vertical-align': 'top'}"></p-column>
                    <p-column field="Project" header="Project" [style]="{'overflow':'visible','text-align':'left','vertical-align': 'top'}"></p-column>
                    <p-column field="System" header="System" [style]="{'overflow':'visible','text-align':'left','vertical-align': 'top'}"></p-column>
                    <p-column field="ItemID" header="Item ID" [style]="{'overflow':'visible','text-align':'left','vertical-align': 'top'}"></p-column>
                    <p-column field="ItemDescription" header="Item Description" [style]="{'overflow':'visible','text-align':'left','vertical-align': 'top'}"></p-column>
                    <p-column field="Requirement" header="Requirement" [style]="{'overflow':'visible','text-align':'left','vertical-align': 'top'}"></p-column>
                    <p-column field="CreatedBy1" header="Created By" [style]="{'overflow':'visible','text-align':'left','vertical-align': 'top'}" *ngIf="userRole === 'vendor'"></p-column>
                    <p-column field="VendorName" header="Vendor" [style]="{'overflow':'visible','text-align':'left','vertical-align': 'top'}" *ngIf="userRole === 'designer' || userRole === 'cd' || userRole === 'gl'">
                        <ng-template let-col let-rowData="rowData" pTemplate="body">
                            <div style=" white-space: nowrap;overflow: hidden;text-overflow: ellipsis; max-height: 100px;" pTooltip="Click here see all the Vedors"
                                tooltipPosition="left">
                                <li *ngFor="let data of rowData[col.field]">
                                    {{data ? data.Name : ''}}
                                </li>
                            </div>
                        </ng-template>
                    </p-column>
                    <p-column field="CDName" header="CD Name" [style]="{'overflow':'visible','text-align':'left','vertical-align': 'top'}">
                        <ng-template let-col let-rowData="rowData" pTemplate="body">
                            <li *ngFor="let data of rowData[col.field]">
                                {{data ? data.Name : ''}}
                            </li>
                        </ng-template>
                    </p-column>
                    <p-column field="AttachmentFiles" header="Attachment" [style]="{'text-align':'left','vertical-align': 'top'}">
                        <ng-template let-col let-rowData="rowData" pTemplate="body">
                            <li *ngFor="let data of rowData[col.field]">
                                <!-- <i class="fa fa-paperclip ng-isolate-scope" aria-hidden="true" *ngIf="rowData[col.field].length !== 0" (click)="downloadFile(data)"></i> -->
                                <a pTooltip="Click to View Attachment" tooltipPosition="left" aria-hidden="true" *ngIf="rowData[col.field].length !== 0"
                                    (click)="downloadFile(data)">
                                    <i class="fa fa-paperclip"></i>
                                    <u> View </u>
                                </a>
                            </li>
                            <!-- <i class="fa fa-download fa-2x" pTooltip="Click to Download" tooltipPosition="left" aria-hidden="true" *ngIf="rowData[col.field].length !== 0"
                                (click)="downloadFile(rowData[col.field][0])"></i> -->
                        </ng-template>
                    </p-column>
                    <!-- *ngIf="(userRole === 'designer') || (userRole === 'gl') || (userRole === 'cd' && type === 'request') || (userRole === 'vendor') " -->
                    <p-column [style]="{'overflow':'visible','text-align':'left','vertical-align': 'top'}" header="Action">
                        <ng-template let-request="rowData" pTemplate="body">
                            <button class="btn btn-info btn-circle" style="min-width: 80%;" pTooltip="Click to Select Request" tooltipPosition="left"
                                (click)="onSelectRequest(request)" *ngIf="(userRole === 'designer' && (request.Status === '02-Pending with Designer for info' || request.Status === '07-Pending with Designer for Closure' 
                                || request.Status === '03-Pending with Designer for DIDS SignOff' || request.Status === '04-Pending with Designer for Drawing Approval' || request.Status === '06-Pending with Designer for Sample Approval'))
                                || (userRole === 'gl' && (request.Status === '01-GL Approval Pending' || request.Status === '08-Pending with GL for Closure'))
                                || (userRole === 'cd' && ((request.Status === '02-CD Approval Pending' && type === 'request') || request.Status === '09-Pending with CD for Closure' || request.Status === '05-Pending with CD for Commercials'))
                                || (userRole === 'vendor' && (request.Status === '01-Pending with Vendor'))">
                                <i class="fa fa-2x fa-long-arrow-right" aria-hidden="true"></i>
                            </button>
                        </ng-template>
                    </p-column>
                    <ng-template let-request pTemplate="rowexpansion">
                        <div class="ui-grid ui-grid-responsive ui-fluid" style="font-size:small;padding:20px;background-color: lavender;">
                            <div *ngIf="request.VendorName !== null">
                                <strong> Vendor(s) : </strong>
                            </div>
                            <ul style="list-style-type: none;margin: 0;padding: 0;overflow: hidden;">
                                <li style="float: left; display: block;padding: 5px; text-decoration: none;" *ngFor="let data of request.VendorName">
                                    <span>â€¢</span> {{data ? data.Name : ''}}
                                </li>
                            </ul>
                            <div *ngIf="request.VendorName === null">
                                No Vendors have been assigned yet
                            </div>
                        </div>
                    </ng-template>
                    <!-- <ng-template let-request pTemplate="rowexpansion">
                                <div class="ui-grid ui-grid-responsive ui-fluid" style="font-size:small;padding:20px;background-color: lavender;">
                                    <div class="ui-grid-row">
                                        <div class="ui-grid-col-4">
                                            <b>Created By&nbsp;: </b>{{request.CreatedBy? request.CreatedBy.Name : ''}}
                                        </div>
                                        <div class="ui-grid-col-4">
                                            <b>GL Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :</b> {{request.GLName ?request.GLName.Name:'-'}}
                                        </div>
                                        <div class="ui-grid-col-4">
                                            <b>CD Name :</b> {{request.CDName?request.CDName.Name:'-'}}
                                        </div>
                                    </div>
                                    <div class="ui-grid-row">
                                        <div class="ui-grid-col-4">
                                            <b>Status&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :</b> {{request.Status?request.Status:'-'}}
                                        </div>
                                        <div class="ui-grid-col-4">
                                                <b>Description On Data&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :</b>
                                                {{request.DescriptionOnData_?request.DescriptionOnData_:'-'}}
                                            </div>
                                    </div>
                                </div>
                            </ng-template> -->
                </p-dataTable>
            </div>

        </div>
    </div>
</div>
<div class="view-side-form">
    <router-outlet></router-outlet>
</div>